<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>F√∫tbol 5</title>
  <meta name="theme-color" content="#10b981"/>
  <link rel="manifest" id="mf"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{
      --bp: 0px;
      --pitch-image: var(--pitch-image-mobile);
      --pitch-image-mobile: url('assets/cesped-vert.webp');
      --pitch-image-desktop: var(--pitch-image-mobile);
      --pitch-darken: 0.50;
      --parallax-speed: 0.35;
    }
    html,body{background:#0b1220;color:#e2e8f0;margin:0;overflow-x:hidden}
    img,svg{max-width:100%;height:auto}
    #bg-parallax{position:fixed;inset:0;z-index:0;
      background-image:linear-gradient(rgba(11,18,32,var(--pitch-darken)),rgba(11,18,32,var(--pitch-darken))),var(--pitch-image);
      background-repeat:repeat-y,repeat-y;background-size:100% auto,100% auto;background-position:center var(--bp),center var(--bp);
      will-change:background-position}
    @media (min-width:1024px){:root{--parallax-speed:0} #bg-parallax{background-repeat:no-repeat,no-repeat;background-size:cover,cover;background-position:center center,center center}}
    #root{position:relative;z-index:1}
    .mask-shield{ -webkit-clip-path: polygon(50% 0, 88% 18%, 88% 58%, 50% 100%, 12% 58%, 12% 18%); clip-path: polygon(50% 0, 88% 18%, 88% 58%, 50% 100%, 12% 58%, 12% 18%); }
  </style>
</head>
<body>
<div id="bg-parallax" aria-hidden="true"></div>
<div id="root"></div>

<script>
(async()=>{
  try{
    const base=location.pathname.endsWith('/')?location.pathname:location.pathname.replace(/[^/]+$/,'');
    const L=document.getElementById('mf');
    const mk=(n,c)=>{const a=document.createElement('canvas');a.width=a.height=n;const x=a.getContext('2d');
      x.fillStyle=c;x.fillRect(0,0,n,n);x.fillStyle='#0b1220';x.textAlign='center';x.textBaseline='middle';
      x.font=`${Math.floor(n*.42)}px sans-serif`;x.fillText('F5',n/2,n/2);return a.toDataURL('image/png')};
    const man={name:'F√∫tbol 5',short_name:'Futbol5',start_url:base,scope:base,display:'standalone',
      background_color:'#0f172a',theme_color:'#10b981',
      icons:[{src:`${base}icons/icon-192.png`,sizes:'192x192',type:'image/png'},
             {src:`${base}icons/icon-512.png`,sizes:'512x512',type:'image/png'}]};
    try{
      const r1=await fetch(`${base}icons/icon-192.png`,{method:'HEAD'});
      const r2=await fetch(`${base}icons/icon-512.png`,{method:'HEAD'});
      if(!r1.ok||!r2.ok)throw 0;
    }catch{
      man.icons=[{src:mk(192,'#10b981'),sizes:'192x192',type:'image/png'},{src:mk(512,'#10b981'),sizes:'512x512',type:'image/png'}];
    }
    const b=new Blob([JSON.stringify(man)],{type:'application/manifest+json'});
    L.href=URL.createObjectURL(b);
    if('serviceWorker'in navigator){
      navigator.serviceWorker.register(`${base}sw.js`,{scope:base}).catch(()=>{});
    }
  }catch(e){console.log('[PWA]',e)}
})();
</script>

<script>
(function(){
  try{
    const base=location.pathname.endsWith('/')?location.pathname:location.pathname.replace(/[^/]+$/,'');
    const m=base+'assets/cesped-vert.webp';
    const d=base+'assets/cesped-horiz.webp';
    document.documentElement.style.setProperty('--pitch-image-mobile',`url('${m}')`);
    function setDesk(v){document.documentElement.style.setProperty('--pitch-image-desktop',v);apply()}
    fetch(d,{method:'HEAD'}).then(r=>setDesk((r&&r.ok)?`url('${d}')`:'var(--pitch-image-mobile)')).catch(()=>setDesk('var(--pitch-image-mobile)'));
    function apply(){
      const isDesk=window.matchMedia('(min-width:1024px)').matches;
      const img=isDesk?'var(--pitch-image-desktop)':'var(--pitch-image-mobile)';
      document.documentElement.style.setProperty('--pitch-image',img);
    }
    window.addEventListener('resize',apply);apply();
  }catch(e){}
})();
</script>

<script>
(function(){
  let ticking=false;
  function sp(){const v=getComputedStyle(document.documentElement).getPropertyValue('--parallax-speed');const n=parseFloat(v);return isNaN(n)?0:n}
  function onScroll(){if(ticking)return;ticking=true;requestAnimationFrame(()=>{document.documentElement.style.setProperty('--bp',(-window.scrollY*sp())+'px');ticking=false})}
  window.addEventListener('scroll',onScroll,{passive:true});window.addEventListener('resize',onScroll);onScroll();
})();
</script>

<script type="text/babel">
const {useMemo,useState,useEffect}=React;
const STAT=['ATA','PAS','REG','VEL','DEF','FIS','ARQ','EQP'];
const SL={ATA:'Ataque',PAS:'Pase',REG:'Regate',VEL:'Velocidad',DEF:'Defensa',FIS:'F√≠sico',ARQ:'Arco',EQP:'Equipo'};
const TC={A:{stroke:'rgba(16,185,129,1)',fill:'rgba(16,185,129,0.18)',dot:'bg-emerald-500',hex:'#10b981'},
          B:{stroke:'rgba(59,130,246,1)',fill:'rgba(59,130,246,0.18)',dot:'bg-blue-500',hex:'#3b82f6'}};
const W={ATA:.18,DEF:.16,PAS:.14,REG:.14,VEL:.14,FIS:.10,ARQ:.07,EQP:.07};
const K=0.6;
const clamp=(v,a=0,b=10)=>Math.max(a,Math.min(b,v));
const avg=a=>a.length?a.reduce((p,c)=>p+c,0)/a.length:0;
const globalOf=p=>{let s=0,w=0;for(const k in W){s+=(p[k]||0)*W[k];w+=W[k]}return +(s/w).toFixed(2)};

const SUBS={ ATA:['Posici√≥n','Definici√≥n','Potencia'], PAS:['Visi√≥n','Corto','Largo'],
  REG:['Agilidad','Control','Equilibrio'], VEL:['Aceleraci√≥n','Punta','Arranque'],
  DEF:['Marcaje','Anticipaci√≥n','Entradas'], FIS:['Resistencia','Fuerza','Salto'],
  ARQ:['Reflejos','Manos','Saque'], EQP:['Colaboraci√≥n','Disciplina','Liderazgo'] };
const FLAGS='üá¶üá∑,üáßüá∑,üá∫üáæ,üáµüáæ,üá®üá±,üáßüá¥,üáµüá™,üá®üá¥,üá™üá®,üá≤üáΩ,üá™üá∏,üáµüáπ,üáÆüáπ,üá´üá∑,üá©üá™,üá¨üáß,üá∫üá∏,üáØüáµ'.split(',');
const hR=s=>{let h=0;for(let i=0;i<s.length;i++)h=(h*33+s.charCodeAt(i))>>>0;return (h%1000)/1000};
const substatsOf=p=>{ const o={}; for(const k of STAT){ o[k]=(SUBS[k]||[]).map((n,i)=>{ const base=p[k]||5; const noise=(hR((p.id||'')+k+i)-.5)*2; const v=clamp(Math.round(base+noise),1,10); return {n,v}; }); } return o; };

const SEED=[
 {id:'1',nombre:'Leo',equipoPropio:'La 10',equipoFavorito:'Barcelona',fotoUrl:'https://i.pravatar.cc/150?img=1',ATA:10,PAS:9,REG:10,VEL:9,DEF:4,FIS:7,ARQ:3,EQP:8},
 {id:'2',nombre:'Fabi',equipoPropio:'La 10',equipoFavorito:'Col√≥n',fotoUrl:'https://i.pravatar.cc/150?img=6',ATA:7,PAS:8,REG:7,VEL:7,DEF:7,FIS:7,ARQ:4,EQP:9},
 {id:'3',nombre:'Cuti',equipoPropio:'Muralla',equipoFavorito:'Belgrano',fotoUrl:'https://i.pravatar.cc/150?img=4',ATA:5,PAS:6,REG:5,VEL:7,DEF:10,FIS:9,ARQ:4,EQP:7},
 {id:'4',nombre:'Dibu',equipoPropio:'Muralla',equipoFavorito:'Arsenal',fotoUrl:'https://i.pravatar.cc/150?img=5',ATA:3,PAS:5,REG:4,VEL:5,DEF:8,FIS:8,ARQ:10,EQP:7},
 {id:'5',nombre:'Papu',equipoPropio:'Tiki',equipoFavorito:'San Lorenzo',fotoUrl:'https://i.pravatar.cc/150?img=9',ATA:8,PAS:8,REG:9,VEL:8,DEF:5,FIS:6,ARQ:3,EQP:7},
 {id:'6',nombre:'Nico',equipoPropio:'Tiki',equipoFavorito:'Boca',fotoUrl:'https://i.pravatar.cc/150?img=8',ATA:7,PAS:7,REG:7,VEL:8,DEF:6,FIS:7,ARQ:4,EQP:6},
 {id:'7',nombre:'Chino',equipoPropio:'Muralla',equipoFavorito:"Newell's",fotoUrl:'https://i.pravatar.cc/150?img=10',ATA:5,PAS:6,REG:5,VEL:6,DEF:8,FIS:7,ARQ:8,EQP:6},
 {id:'8',nombre:'Joa',equipoPropio:'La 10',equipoFavorito:'River',fotoUrl:'https://i.pravatar.cc/150?img=7',ATA:6,PAS:6,REG:6,VEL:7,DEF:8,FIS:8,ARQ:5,EQP:7},
 {id:'9',nombre:'Fideo',equipoPropio:'Tiki',equipoFavorito:'Rosario C.',fotoUrl:'https://i.pravatar.cc/150?img=3',ATA:8,PAS:9,REG:9,VEL:8,DEF:6,FIS:6,ARQ:3,EQP:8},
 {id:'10',nombre:'Kuni',equipoPropio:'La 10',equipoFavorito:'Independiente',fotoUrl:'https://i.pravatar.cc/150?img=2',ATA:9,PAS:7,REG:8,VEL:9,DEF:5,FIS:7,ARQ:3,EQP:7},
 {id:'11',nombre:'Tomi',equipoPropio:'Muralla',equipoFavorito:'Talleres',fotoUrl:'https://i.pravatar.cc/150?img=11',ATA:6,PAS:7,REG:6,VEL:7,DEF:7,FIS:7,ARQ:5,EQP:6},
 {id:'12',nombre:'Gonza',equipoPropio:'Tiki',equipoFavorito:'Racing',fotoUrl:'https://i.pravatar.cc/150?img=12',ATA:7,PAS:6,REG:7,VEL:8,DEF:6,FIS:7,ARQ:4,EQP:6},
];

const KEYS={players:'f5.players',selected:'f5.selected',teams:'f5.teams',kchem:'f5.kchem'};
const J=(s,d)=>{try{return JSON.parse(s)}catch{return d}};
const withG=a=>a.map(p=>({...p,_GLOBAL:globalOf(p)}));

const chemBuild=arr=>{const q={};for(const a of arr){q[a.id]={};for(const b of arr){if(a.id===b.id){q[a.id][b.id]=10;continue}
  if(q[b.id]?.[a.id]!=null){q[a.id][b.id]=q[b.id][a.id];continue}
  let v=5;if(a.equipoPropio&&b.equipoPropio&&a.equipoPropio===b.equipoPropio)v+=1.2;
  if(a.equipoFavorito&&b.equipoFavorito&&a.equipoFavorito===b.equipoFavorito)v+=.8;
  v+=(((a.EQP+b.EQP)/2)-5)*.15;q[a.id][b.id]=clamp(+v.toFixed(2),1,10)}}return q};
const chemTeam=(ids,chem)=>{const arr=Array.isArray(ids)?ids.filter(Boolean):[];if(arr.length<=1)return 10;let t=0,p=0;
  for(let i=0;i<arr.length;i++)for(let j=i+1;j<arr.length;j++){t+=chem[arr[i]]?.[arr[j]]??5;p++}
  return +(t/(p||1)).toFixed(2)};
const teamGlobal=(ids,map)=>{const arr=Array.isArray(ids)?ids.filter(id=>map[id]):[];return +avg(arr.map(id=>map[id]._GLOBAL)).toFixed(2)};
const teamScoreUI=(ids,map,chem,k)=>+(teamGlobal(ids,map)+chemTeam(ids,chem)*k).toFixed(2);

const shuffle=a=>{const x=[...a];for(let i=x.length-1;i>0;i--){const j=(Math.random()*(i+1)|0);[x[i],x[j]]=[x[j],x[i]]}return x};
const randSplit=ids=>{const s=shuffle(ids);const m=Math.floor(s.length/2);return[s.slice(0,m),s.slice(m)]};
const scoreDiff=(A,B,map,chem,k)=>{const sA=teamScoreUI(A,map,chem,k),sB=teamScoreUI(B,map,chem,k);return{A:[...A],B:[...B],diff:Math.abs(sA-sB),m:{sA,sB}}};
const balanced=(ids,map,chem,k=K)=>{let[A,B]=randSplit(ids);let best=scoreDiff(A,B,map,chem,k);
  for(let t=0;t<900;t++){const i=Math.floor(Math.random()*A.length),j=Math.floor(Math.random()*B.length);
    [A[i],B[j]]=[B[j],A[i]];const cur=scoreDiff(A,B,map,chem,k);
    if(cur.diff<=best.diff||Math.random()<.12)best=cur;else[A[i],B[j]]=[B[j],A[i]]}
  return{A:best.A,B:best.B,m:best.m}};

const Pill=({children,className=''})=> <span className={`inline-block rounded-full px-2 py-0.5 text-xs ${className}`}>{children}</span>;

const FifaCard=({p})=>{
  const rate=Math.round((p._GLOBAL||globalOf(p))*10);
  return(
    <div className="relative w-44 rounded-2xl bg-gradient-to-b from-yellow-200 to-yellow-500 text-slate-900 p-2 shadow ring-1 ring-yellow-700">
      <div className="flex justify-between items-start">
        <div className="text-center leading-4">
          <div className="text-3xl font-black">{rate}</div>
          <div className="text-xs font-bold">{p.pos||'F5'}</div>
          <div className="text-base">{p.bandera||''}</div>
        </div>
        {p.escudoUrl
          ? <img src={p.escudoUrl} className="h-9 w-8 object-contain mask-shield ring-1 ring-yellow-700/60"/>
          : <div className="h-9 w-8 grid place-items-center bg-white/70 text-xs font-extrabold mask-shield ring-1 ring-yellow-700/60">{(p.equipoPropio||'').slice(0,2).toUpperCase()}</div>}
      </div>
      <div className="mt-2 grid place-items-center"><img src={p.fotoUrl} className="h-24 w-24 rounded-xl object-cover ring-2 ring-yellow-700"/></div>
      <div className="mt-2 text-center text-sm font-extrabold truncate">{p.nombre}</div>
      <div className="mt-1 grid grid-cols-2 gap-x-2 gap-y-1 text-[11px] font-semibold">
        {STAT.map(k=>( <div key={k} className="flex items-center gap-1"><span>{k}</span><span className="tabular-nums">{p[k]}</span></div> ))}
      </div>
    </div>
  );
};

const RadarChart=({size,max=10,keys=STAT,dataSeries})=>{
  const w=(typeof window!=='undefined'&&window.innerWidth)||320;const s=size??Math.max(180,Math.min(260,Math.floor(w*.85)));
  const cx=s/2,cy=s/2,r=s*.4,N=keys.length;const ang=i=>Math.PI*2*i/N-Math.PI/2;
  const pt=(i,v)=>{const a=ang(i),rr=r*(v/max);return[cx+rr*Math.cos(a),cy+rr*Math.sin(a)]};const lv=[2,4,6,8,10];
  return(<svg viewBox={`0 0 ${s} ${s}`} width="100%" className="mx-auto block">
    {lv.map((L,i)=>{const d=keys.map((_,j)=>pt(j,L)).map(([x,y])=>`${x},${y}`).join(' ');return <polygon key={i} points={d} fill="none" stroke="rgba(148,163,184,.25)" strokeWidth={1}/>})}
    {keys.map((k,i)=>{const[x,y]=pt(i,max);return <line key={k} x1={cx} y1={cy} x2={x} y2={y} stroke="rgba(148,163,184,.3)" strokeWidth={1}/>})}
    {keys.map((k,i)=>{const[x,y]=pt(i,max+.9);return <text key={k} x={x} y={y} textAnchor="middle" dominantBaseline="middle" fontSize={11} fill="#cbd5e1">{k}</text>})}
    {dataSeries.map((srs,i)=>{const d=keys.map((k,j)=>pt(j,srs.values[k]??0)).map(([x,y])=>`${x},${y}`).join(' ');return(<g key={i}><polygon points={d} fill={srs.fill} stroke={srs.stroke} strokeWidth={2}/></g>)} )}
  </svg>);
};

const BarsChart=({values,max=10,accent})=>{
  const c=accent||'#22d3ee';return(<div className="space-y-2">{STAT.map(k=>(<div key={k}>
    <div className="mb-1 flex items-center justify-between text-sm"><span className="text-slate-300" title={SL[k]}>{k}</span><span className="font-semibold">{values[k]}</span></div>
    <div className="h-2 w-full rounded bg-slate-700"><div className="h-2 rounded" style={{width:`${Math.max(0,Math.min(100,(values[k]/max)*100))}%`,backgroundColor:c}}/></div>
  </div>))}</div>);
};

const PlayerDetails=({p})=>{
  const s=p.subs||substatsOf(p);return(<div className="grid grid-cols-1 sm:grid-cols-2 gap-3"><FifaCard p={p}/>
    <div className="space-y-2">
      <div className="rounded-xl bg-slate-800/60 p-2 ring-1 ring-slate-700"><div className="mb-1 text-sm font-semibold">Radar</div>
        <RadarChart size={220} dataSeries={[{label:p.nombre,values:p,stroke:'rgba(34,211,238,1)',fill:'rgba(34,211,238,0.18)'}]}/>
      </div>
      {STAT.map(k=>(<div key={k} className="rounded-xl bg-slate-800/60 p-2 ring-1 ring-slate-700">
        <div className="mb-1 text-sm font-semibold">{SL[k]} <span className="opacity-75">({p[k]})</span></div>
        {(s[k]||[]).map((it,idx)=>(<div key={idx} className="mb-1"><div className="flex justify-between text-xs"><span>{it.n}</span><span className="font-semibold">{it.v}</span></div><div className="h-1.5 rounded bg-slate-700"><div className="h-1.5 rounded" style={{width:`${it.v*10}%`,backgroundColor:'#22c55e'}}/></div></div>))}
      </div>))}
    </div></div>);
};

const PlayerModal=({player,onClose})=>{
  const [mode,setMode]=React.useState('det');if(!player)return null;return(<div className="fixed inset-0 z-50 grid place-items-center bg-black/50 p-3" onClick={onClose}>
    <div className="w-full max-w-4xl max-h-[85vh] overflow-auto rounded-2xl bg-slate-900 p-4 ring-1 ring-slate-700" onClick={e=>e.stopPropagation()}>
      <div className="mb-2 flex items-center gap-3">
        <img src={player.fotoUrl} alt={player.nombre} className="h-12 w-12 rounded-xl object-cover ring-1 ring-slate-700"/>
        <div className="min-w-0">
          <div className="truncate text-lg font-semibold">{player.nombre}</div>
          <div className="text-xs text-slate-400">Rating: {Math.round(player._GLOBAL*10)} ‚Äî Propio: {player.equipoPropio||'-'} ‚Äî Fav: {player.equipoFavorito||'-'} {player.bandera?`‚Äî ${player.bandera}`:''}</div>
        </div>
        <button onClick={onClose} className="ml-auto rounded-xl bg-slate-800 px-3 py-1 text-sm text-slate-200 ring-1 ring-slate-700 hover:bg-slate-700">Cerrar</button>
      </div>
      <div className="mb-3 flex flex-wrap gap-2"><button onClick={()=>setMode('det')} className={`rounded-xl px-3 py-1 text-sm ring-1 ${mode==='det'?'bg-cyan-600 text-white ring-cyan-500':'bg-slate-800 text-slate-200 ring-slate-700'}`}>Detalles</button></div>
      <PlayerDetails p={player}/>
    </div></div>);
};

const PlayerRow=({p,selected,onToggle,onOpen})=> (<div className="flex items-center gap-3 rounded-xl bg-slate-900/70 p-3 ring-1 ring-slate-700">
  <img src={p.fotoUrl} alt={p.nombre} className="h-10 w-10 rounded-full object-cover ring-1 ring-slate-700"/>
  <div className="min-w-0 flex-1">
    <div className="flex items-center justify-between gap-2">
      <button onClick={onOpen} className="min-w-0 text-left"><div className="truncate text-base font-semibold">{p.nombre}</div>
      <div className="mt-0.5 flex flex-wrap items-center gap-1 text-xs text-slate-400">
        <span className="inline-block rounded-full px-2 py-0.5 text-xs bg-slate-800/80 text-slate-200">Rating: {Math.round(p._GLOBAL*10)}</span>
        {p.equipoPropio&&<span className="inline-block rounded-full px-2 py-0.5 text-xs bg-indigo-600/20 text-indigo-200">Propio: {p.equipoPropio}</span>}
        {p.equipoFavorito&&<span className="inline-block rounded-full px-2 py-0.5 text-xs bg-cyan-600/20 text-cyan-200">Fav: {p.equipoFavorito}</span>}
      </div></button>
      <button onClick={onToggle} className={`rounded-xl px-3 py-1 text-sm ring-1 ${selected?'bg-emerald-600 text-white ring-emerald-500':'bg-slate-800 text-slate-200 ring-slate-700 hover:bg-slate-700'}`}>{selected?'‚úì Convocado':'+ Convocar'}</button>
    </div>
    <div className="mt-2 grid grid-cols-4 gap-1 text-[11px] text-slate-300">{STAT.map(k=>(<div key={k} className="flex items-center justify-between rounded-lg bg-slate-800/60 px-2 py-1"><span className="font-medium" title={SL[k]}>{k}</span><span className="tabular-nums">{p[k]}</span></div>))}</div>
  </div>
</div>);

const teamAvg=(ids,map)=>{const o={};const arr=Array.isArray(ids)?ids.filter(id=>map[id]):[];STAT.forEach(k=>o[k]=+avg(arr.map(id=>map[id][k]??0)).toFixed(2));return o};
const TeamRadarCompare=({A,B,map})=>{const a=teamAvg(A,map),b=teamAvg(B,map);return(<div className="rounded-2xl bg-slate-900/70 p-3 ring-1 ring-slate-700"><div className="mb-2 text-center text-sm text-slate-300">Radar comparativo (promedio por stat)</div><RadarChart dataSeries={[{label:'A',values:a,stroke:TC.A.stroke,fill:TC.A.fill},{label:'B',values:b,stroke:TC.B.stroke,fill:TC.B.fill}]}/><div className="mt-2 flex justify-center gap-4 text-xs text-slate-300"><span className="inline-flex items-center gap-1"><span className={`h-2 w-2 rounded-full ${TC.A.dot}`}></span> Equipo A</span><span className="inline-flex items-center gap-1"><span className={`h-2 w-2 rounded-full ${TC.B.dot}`}></span> Equipo B</span></div></div>)};
const BalanceIndicator=({A,B,map,chem,kChem})=>{const a=(Array.isArray(A)?A:[]).filter(id=>map[id]);const b=(Array.isArray(B)?B:[]).filter(id=>map[id]);const sA=teamScoreUI(a,map,chem,kChem),sB=teamScoreUI(b,map,chem,kChem),d=+Math.abs(sA-sB).toFixed(2);let lb='Parejo',cls='bg-emerald-600/15 text-emerald-200 ring-emerald-500/30';if(d>=.8){lb='Desbalanceado';cls='bg-rose-600/15 text-rose-200 ring-rose-500/30'}else if(d>=.3){lb='Aceptable';cls='bg-amber-600/15 text-amber-100 ring-amber-500/30'}return(<div className={`rounded-2xl p-3 ring-1 ${cls}`}><div className="flex items-center justify-between text-sm"><div className="font-semibold">Balance del partido</div><div className="text-xs opacity-80">Diff: {d}</div></div><div className="mt-1 text-sm">Resultado: <span className="font-semibold">{lb}</span> <span className="opacity-80">(A: {sA} vs B: {sB})</span></div><div className="mt-1 text-xs opacity-80">Umbrales: Parejo {'<'} 0.30 ‚Äî Aceptable {'<'} 0.80 ‚Äî Desbalanceado {'‚â•'} 0.80</div></div>)};
const TeamMiniSummary=({ids,map,chem,kChem})=>{ const list=(Array.isArray(ids)?ids:[]).filter(id=>map[id]); const g=teamGlobal(list,map), rating=Math.round(g*10); const c=chemTeam(list,chem); const s=teamScoreUI(list,map,chem,kChem); return(<div className="grid grid-cols-3 gap-1 text-center"><div><div className="text-slate-400 text-xs">Rating</div><div className="font-bold">{rating}</div></div><div><div className="text-slate-400 text-xs">Qu√≠mica</div><div className="font-bold">{c}</div></div><div><div className="text-slate-400 text-xs">Score</div><div className="font-bold">{s}</div></div></div>)};
const TeamCard=({title,teamKey,ids,map,chem,onOpenPlayer,kChem})=>{ const list=(Array.isArray(ids)?ids:[]).filter(id=>map[id]); const g=teamGlobal(list,map), rating=Math.round(g*10); const c=chemTeam(list,chem); const s=teamScoreUI(list,map,chem,kChem); const col=TC[teamKey]||TC.A; return( <div className="rounded-2xl bg-slate-900/70 p-3 ring-1 ring-slate-700"> <div className="mb-2 flex items-center justify-between"> <h3 className="flex items-center gap-2 text-base font-semibold"><span className={`h-2.5 w-2.5 rounded-full ${col.dot}`}/> {title}</h3> <div className="text-xs text-slate-400">Jugadores: {list.length}</div> </div> <div className="mb-3 grid grid-cols-3 gap-2 text-sm"> <div className="rounded-xl bg-slate-800/70 p-2 text-center"><div className="text-slate-400">Rating</div><div className="text-lg font-bold">{rating}</div></div> <div className="rounded-xl bg-slate-800/70 p-2 text-center"><div className="text-slate-400">Qu√≠mica</div><div className="text-lg font-bold">{c}</div></div> <div className="rounded-xl bg-slate-800/70 p-2 text-center"><div className="text-slate-400">Score</div><div className="text-lg font-bold">{s}</div></div> </div> <ul className="space-y-1 text-sm"> {list.map(id=>( <li key={id} className="flex items-center justify-between rounded-lg bg-slate-800/60 px-2 py-1"> <button onClick={()=>onOpenPlayer(map[id])} className="truncate text-left hover:underline">{map[id].nombre}</button> <span className="text-slate-300">R:{Math.round(map[id]._GLOBAL*10)} - EQP:{map[id].EQP}</span> </li> ))} </ul> </div> ); };

const App=()=>{
  const storeP=J(localStorage.getItem(KEYS.players),null);
  const initP=withG(Array.isArray(storeP)&&storeP.length?storeP:SEED);
  const[players,setPlayers]=React.useState(initP);
  const[selected,setSelected]=React.useState(()=>new Set(J(localStorage.getItem(KEYS.selected),[])));
  const[teams,setTeams]=React.useState(()=>J(localStorage.getItem(KEYS.teams),null));
  const[kChem,setKChem]=React.useState(()=>+(localStorage.getItem(KEYS.kchem)??K));
  const map=React.useMemo(()=>Object.fromEntries(players.map(p=>[p.id,p])),[players]);
  const chem=React.useMemo(()=>chemBuild(players),[players]);
  const[tab,setTab]=React.useState('partido');
  const[modal,setModal]=React.useState(null);
  React.useEffect(()=>localStorage.setItem(KEYS.players,JSON.stringify(players)),[players]);
  React.useEffect(()=>localStorage.setItem(KEYS.selected,JSON.stringify([...selected])),[selected]);
  React.useEffect(()=>localStorage.setItem(KEYS.teams,JSON.stringify(teams)),[teams]);
  React.useEffect(()=>localStorage.setItem(KEYS.kchem,String(kChem)),[kChem]);
  const convocados=[...selected];const canMake=convocados.length===10;
  const toggle=id=>setSelected(s=>{const n=new Set(s);n.has(id)?n.delete(id):n.add(id);return n});
  const makeR=()=>{if(!canMake)return; const [A,B]=((ids)=>{const s=[...ids];for(let i=s.length-1;i>0;i--){const j=(Math.random()*(i+1)|0);[s[i],s[j]]=[s[j],s[i]]}const m=Math.floor(s.length/2);return[s.slice(0,m),s.slice(m)]})(convocados); setTeams({A,B}); try{window.scrollTo({top:0,behavior:'smooth'})}catch{}};
  const makeB=()=>{if(!canMake)return; const{A,B}=balanced(convocados,map,chem,kChem); setTeams({A,B}); try{window.scrollTo({top:0,behavior:'smooth'})}catch{}};
  return(<div className="mx-auto max-w-screen-md p-3 text-slate-100"><header className="sticky top-0 z-10 mb-3 rounded-xl bg-slate-950/90 p-3 ring-1 ring-slate-800 backdrop-blur"><div className="flex items-center justify-between gap-2"><h1 className="text-lg font-bold">F√∫tbol 5 - Generador</h1><div className="flex items-center gap-2"><div className={`rounded-xl px-3 py-1 text-sm ring-1 ${convocados.length<10?'bg-amber-600/20 text-amber-200 ring-amber-500/40':convocados.length>10?'bg-rose-600/20 text-rose-200 ring-rose-500/40':'bg-emerald-600/20 text-emerald-200 ring-emerald-500/40'}`}>Convocados: {convocados.length}/10</div></div></div><nav className="mt-2 grid grid-cols-2 gap-2"><button onClick={()=>setTab('partido')} className={`rounded-xl px-3 py-2 text-sm ring-1 ${tab==='partido'?'bg-slate-800 text-white ring-slate-600':'bg-slate-900/70 text-slate-200 ring-slate-800'}`}>‚öΩ Partido</button><button onClick={()=>setTab('plantel')} className={`rounded-xl px-3 py-2 text-sm ring-1 ${tab==='plantel'?'bg-slate-800 text-white ring-slate-600':'bg-slate-900/70 text-slate-200 ring-slate-800'}`}>üë• Plantel</button></nav>{tab==='partido'&&teams&&(<div className="mt-2 grid grid-cols-2 gap-2 text-sm"><div className="rounded-xl bg-slate-900/70 p-2 ring-1 ring-slate-800"><div className="flex items-center gap-2 font-semibold"><span className={`h-2.5 w-2.5 rounded-full ${TC.A.dot}`}/><span>Equipo A</span></div><TeamMiniSummary ids={teams.A} map={map} chem={chem} kChem={kChem}/></div><div className="rounded-xl bg-slate-900/70 p-2 ring-1 ring-slate-800"><div className="flex items-center gap-2 font-semibold"><span className={`h-2.5 w-2.5 rounded-full ${TC.B.dot}`}/><span>Equipo B</span></div><TeamMiniSummary ids={teams.B} map={map} chem={chem} kChem={kChem}/></div></div>)}</header>{tab==='plantel'?(<section className="space-y-2">{players.map(p=>(<div key={p.id} className="space-y-2"><PlayerRow p={p} selected={selected.has(p.id)} onToggle={()=>toggle(p.id)} onOpen={()=>setModal(p)}/></div>))}</section>):(<section className="space-y-3">{!canMake&&(<div className="rounded-xl bg-amber-600/15 p-3 text-amber-100 ring-1 ring-amber-600/30">Necesit√°s exactamente 10 convocados. Elegilos en <span className="font-semibold">Plantel</span>.</div>)}{teams&&(<><TeamCard title="Equipo A" teamKey="A" ids={teams.A} map={map} chem={chem} onOpenPlayer={setModal} kChem={kChem}/><TeamCard title="Equipo B" teamKey="B" ids={teams.B} map={map} chem={chem} onOpenPlayer={setModal} kChem={kChem}/><BalanceIndicator A={teams.A} B={teams.B} map={map} chem={chem} kChem={kChem}/><TeamRadarCompare A={teams.A} B={teams.B} map={map}/><div className="grid grid-cols-1 gap-3 md:grid-cols-2"><div className="rounded-2xl bg-slate-900/70 p-3 ring-1 ring-slate-700"><div className="mb-2 font-semibold">Barras - Equipo A</div><BarsChart values={teamAvg(teams.A,map)} accent={TC.A.hex}/></div><div className="rounded-2xl bg-slate-900/70 p-3 ring-1 ring-slate-700"><div className="mb-2 font-semibold">Barras - Equipo B</div><BarsChart values={teamAvg(teams.B,map)} accent={TC.B.hex}/></div></div></>)}</section>)}{tab==='partido'&&(<div className="sticky bottom-2 mt-4 grid grid-cols-2 gap-2"><button onClick={makeR} disabled={!canMake} className={`rounded-2xl px-4 py-3 text-base font-semibold ring-1 ${!canMake?'bg-slate-800/40 text-slate-500 ring-slate-800 cursor-not-allowed':'bg-slate-800 text-slate-100 ring-slate-700 hover:bg-slate-700'}`}>üé≤ Azar</button><button onClick={makeB} disabled={!canMake} className={`rounded-2xl px-4 py-3 text-base font-semibold ring-1 ${!canMake?'bg-emerald-600/40 text-emerald-200 ring-emerald-800 cursor-not-allowed':'bg-emerald-600 text-white ring-emerald-500 hover:bg-emerald-500'}`}>‚öñÔ∏è Equilibrado</button></div>)}<footer className="mt-6 rounded-xl bg-slate-900/60 p-3 text-[12px] text-slate-300 ring-1 ring-slate-800"><div className="font-semibold">Leyenda:</div><div>ATA=Ataque ‚Äî PAS=Pase ‚Äî REG=Regate ‚Äî VEL=Velocidad ‚Äî DEF=Defensa ‚Äî FIS=F√≠sico ‚Äî ARQ=Arco ‚Äî EQP=Trabajo en equipo</div><div className="mt-1 text-[11px] opacity-80">Cada stat tiene 3 substats que pod√©s editar en la ficha del jugador.</div></footer><PlayerModal player={modal} onClose={()=>setModal(null)}/></div>);
};

(function t(){try{const ps=withG(SEED);const m=Object.fromEntries(ps.map(p=>[p.id,p]));const ch=chemBuild(ps);const ids=ps.slice(0,10).map(p=>p.id);const[a,b]=randSplit(ids);console.log('[TEST] rand',a.length,b.length);const g0=globalOf(ps[0]);if(!(g0>=1&&g0<=10))throw'global fuera de rango';const bb=balanced(ids,m,ch,0.6);if(!(bb.A.length===5&&bb.B.length===5))throw'balanced 5/5';if(!(chemTeam(bb.A,ch)>=1&&chemTeam(bb.A,ch)<=10))throw'chem 1..10';}catch(e){console.error('[TEST FAIL]',e)}})();

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
