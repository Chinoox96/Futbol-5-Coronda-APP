<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>F5C</title>
  <meta name="theme-color" content="#10b981"/>
  <link id="mf" rel="manifest"/>

  <!-- Tailwind + React + Babel -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Export/Share -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --bp: 0px;
      --pitch-image: url('assets/cesped-vert.webp');
      --pitch-darken: 0.50;
      --header-h: 140px;
    }
    html,body{background:#0b1220;color:#e2e8f0;margin:0;overflow-x:hidden}
    img,svg{max-width:100%;height:auto}
    #bg-parallax{
      position:fixed;inset:0;z-index:0;
      background:
        linear-gradient(90deg,rgba(59,130,246,.15),rgba(16,185,129,.12),rgba(239,68,68,.15)),
        var(--pitch-image);
      background-size:cover;
      background-position:center;
    }
    #root{position:relative;z-index:1}
    .app-header{position:fixed;top:0;left:0;right:0;z-index:40;backdrop-filter:blur(10px);background:rgba(8,12,22,.94);border-bottom:1px solid rgba(30,41,59,.8)}
    .header-spacer{height:var(--header-h)}
    .tabs-bar{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:.75rem}
    .tab-large{border-radius:14px;padding:.75rem 1rem;font-weight:700;text-align:center;border:1px solid rgba(51,65,85,.8);background:rgba(2,6,23,.6);color:#cbd5e1}
    .tab-large.active{background:#0b1220;color:#fff;border-color:#4ade80}
    .tabs-viewport{overflow:hidden}
    .tabs-track{display:flex;width:200%;transition:transform .32s cubic-bezier(.22,.7,.12,1)}
    .tabs-page{width:100%;padding:12px}
    .board{position:relative;width:100%;max-width:900px;aspect-ratio:5/3;border-radius:16px;overflow:hidden}
    .board img.field{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .plantel-scroll{max-height:calc(100vh - var(--header-h) - 110px);overflow-y:auto}
    .install-pill{position:fixed;right:12px;bottom:12px;z-index:50}
  </style>
</head>
<body>
  <div id="bg-parallax"></div>
  <div id="root"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    const STAT=['ATA','PAS','REG','VEL','DEF','FIS','ARQ','EQP'];
    const avg=a=>a.length?a.reduce((p,c)=>p+c,0)/a.length:0;
    const globalOf=p=>{
      const w={ATA:.18,DEF:.16,PAS:.14,REG:.14,VEL:.14,FIS:.10,ARQ:.07,EQP:.07};
      let s=0,ww=0;for(const k in w){s+=(p[k]||0)*w[k];ww+=w[k]}return s/ww;
    };
    const J=(s,d)=>{try{return JSON.parse(s)}catch{return d}};

    const SEED=[{id:'1',nombre:'Leo',ATA:9,PAS:8,REG:10,VEL:9,DEF:4,FIS:7,ARQ:3,EQP:8,bandera:'ðŸ‡¦ðŸ‡·',pos:'LA',fotoUrl:''},
                {id:'2',nombre:'Fabi',ATA:7,PAS:7,REG:7,VEL:7,DEF:7,FIS:7,ARQ:4,EQP:7,bandera:'ðŸ‡¦ðŸ‡·',pos:'MC',fotoUrl:''}];

    const rarityOf=p=>{
      const r=Math.round(globalOf(p)*10);
      if(r>=90)return 'special';if(r>=80)return 'gold';if(r>=70)return 'silver';return 'bronze';
    };

    const colorNum100 = v => v>=90?'text-emerald-400'
      : v>=80?'text-emerald-300'
      : v>=70?'text-amber-300'
      : v>=60?'text-amber-200'
      : 'text-rose-300';

    const FifaCard=({p})=>{
      const rate=Math.round(globalOf(p)*10);
      return(
        <div className="w-40 rounded-xl bg-slate-800 p-2 ring-1 ring-slate-700">
          <div className="text-xl font-bold">{rate}</div>
          <div className="text-xs">{p.pos} {p.bandera}</div>
          <div className="text-sm">{p.nombre}</div>
        </div>
      )
    };

    const RadarChart=({size=200,keys=STAT,dataSeries})=>{
      const cx=size/2,cy=size/2,r=size*.4,N=keys.length;
      const ang=i=>Math.PI*2*i/N-Math.PI/2;
      const pt=(i,v)=>[cx+r*(v/10)*Math.cos(ang(i)),cy+r*(v/10)*Math.sin(ang(i))];
      return(
        <svg viewBox={`0 0 ${size} ${size}`} width="100%">
          {dataSeries.map((s,i)=>{
            const d=keys.map((k,j)=>pt(j,s.values[k]||0)).map(([x,y])=>`${x},${y}`).join(' ');
            return <polygon key={i} points={d} fill={s.fill} stroke={s.stroke}/>
          })}
        </svg>
      )
    };

    const TeamRadarCompare=({A,B,map})=>{
      const teamAvg=(ids)=>{const o={};STAT.forEach(k=>o[k]=+avg(ids.map(id=>map[id][k]||0)).toFixed(2));return o};
      const a=teamAvg(A),b=teamAvg(B);
      return(
        <div className="rounded-xl bg-slate-900 p-3 ring-1 ring-slate-700">
          <RadarChart dataSeries={[
            {values:a,stroke:'#10b981',fill:'rgba(16,185,129,0.2)'},
            {values:b,stroke:'#3b82f6',fill:'rgba(59,130,246,0.2)'}
          ]}/>
          <div className="mt-2 flex justify-center gap-4 text-xs text-slate-300">
            <span className="inline-flex items-center gap-1">
              <span className="h-2 w-2 rounded-full" style={{background:'#10b981'}}></span>A
            </span>
            <span className="inline-flex items-center gap-1">
              <span className="h-2 w-2 rounded-full" style={{background:'#3b82f6'}}></span>B
            </span>
          </div>
        </div>
      )
    };

    const App=()=>{
      const [players,setPlayers]=useState(SEED.map(p=>({...p,_GLOBAL:globalOf(p)})));
      const map=useMemo(()=>Object.fromEntries(players.map(p=>[p.id,p])),[players]);
      const [teams,setTeams]=useState({A:players.slice(0,1).map(p=>p.id),B:players.slice(1,2).map(p=>p.id)});

      return(
        <div className="min-h-screen">
          <header className="app-header"><div className="p-4 text-xl font-bold">F5C</div></header>
          <div className="header-spacer"></div>
          <div className="p-4 space-y-4">
            <div className="grid grid-cols-2 gap-2">
              {teams.A.map(id=><FifaCard key={id} p={map[id]}/>)}
              {teams.B.map(id=><FifaCard key={id} p={map[id]}/>)}
            </div>
            <TeamRadarCompare A={teams.A} B={teams.B} map={map}/>
          </div>
        </div>
      )
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
